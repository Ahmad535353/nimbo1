import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayDeque;
import java.util.Deque;
import java.util.HashMap;

/**
 * Created by QotboddiniH on 7/29/17.
 */
public class Analyzer extends Thread {
    HashMap<Long, Actor> actors = new HashMap<Long, Actor>();
    HashMap<Long, Repo> repos = new HashMap<Long, Repo>();

    public Analyzer() {
        Thread.currentThread().setPriority(5);
    }


    public void update(JsonData jsonData) throws InterruptedException {


        Actor actor = jsonData.actor;
//        if (actors.containsKey(actor.id)) {
//            actor.cntr = actors.get(actor.id).cntr;
//            actors.remove(actor.id);
//        }
//        actor.cntr++;
//        actors.put(actor.id, actor);


        try(FileWriter fw = new FileWriter("PersonsMain" + (System.currentTimeMillis()/60000), true);
            BufferedWriter bw = new BufferedWriter(fw);
            PrintWriter out = new PrintWriter(bw))
        {
            out.println(System.currentTimeMillis());
            out.println(actor.id);
            out.println(actor.login);
        } catch (IOException e) {
            //exception handling left as an exercise for the reader
        }

        Repo repo = jsonData.repo;
//        if (repos.containsKey(repo.id)) {
//            repo.cntr = repos.get(repo.id).cntr;
//            repos.remove(repo.id);
//        }
//        repo.cntr++;
//        repos.put(repo.id, repo);

        try(FileWriter fw = new FileWriter("RepositoryMain.txt", true);
            BufferedWriter bw = new BufferedWriter(fw);
            PrintWriter out = new PrintWriter(bw))
        {
            out.println(System.currentTimeMillis());
            out.println(repo.id);
            out.println(repo.name);
        } catch (IOException e) {
            //exception handling left as an exercise for the reader
        }

    }

    @Override
    public void run() {
        while (true) {
            if (Receiver.jsonList.isEmpty()) {
                try {
                    Thread.sleep(100);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            while (!Receiver.jsonList.isEmpty()) {
                try {
                    update(Receiver.jsonList.getFirst());
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                Receiver.jsonList.removeFirst();
                //   System.out.println("hi buddy 2   *" + Receiver.jsonList.size() + "\n");
            }
        }
    }
}

/**
 * {
 * "id":"6356588600",
 * "type":"PullRequestReviewCommentEvent",
 * "actor":{
 * "id":20959584,
 * "login":"roydahan",
 * "display_login":"roydahan",
 * "gravatar_id":"",
 * "url":"https://api.github.com/users/roydahan",
 * "avatar_url":"https://avatars.githubusercontent.com/u/20959584?"
 * },
 * "repo":{
 * "id":48770856,
 * "name":"scylladb/scylla-cluster-tests","url":"https://api.github.com/repos/scylladb/scylla-cluster-tests"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/comments/130236938","pull_request_review_id":53091950,"id":130236938,"diff_hunk":"@@ -1,6 +1,6 @@\n test_duration: 10080\n-stress_cmd: cassandra-stress write cl=QUORUM duration=10080m -schema 'replication(factor=3)' -port jmx=6868 -mode cql3 native -rate threads=1000 -col 'size=FIXED(1024) n=FIXED(1)' -pop seq=1..1000000000 -log interval=5\n-stress_cmd_1: cassandra-stress counter_write cl=QUORUM duration=10080m -schema 'replication(factor=3)' -port jmx=6868 -mode cql3 native -rate threads=1000 -pop seq=1..10000000\n+stress_cmd: cassandra-stress write cl=QUORUM duration=10080m -schema 'replication(factor=3)' -port jmx=6868 -mode cql3 native user=cassandra password=cassandra -rate threads=1000 -col 'size=FIXED(1024) n=FIXED(1)' -pop seq=1..1000000000 -log interval=5\n+stress_cmd_1: cassandra-stress counter_write cl=QUORUM duration=10080m -schema 'replication(factor=3)' -port jmx=6868 -mode cql3 native user=cassandra password=cassandra -rate threads=1000 -pop seq=1..10000000\n n_db_nodes: 4","path":"tests/gce-longevity-1.7-1TB-7days.yaml","position":6,"original_position":6,"commit_id":"1e68163b2240ac7e84ecb64974f06347c288881f","original_commit_id":"1e68163b2240ac7e84ecb64974f06347c288881f","user":{"login":"roydahan","id":20959584,"avatar_url":"https://avatars3.githubusercontent.com/u/20959584?v=4","gravatar_id":"","url":"https://api.github.com/users/roydahan","html_url":"https://github.com/roydahan","followers_url":"https://api.github.com/users/roydahan/followers","following_url":"https://api.github.com/users/roydahan/following{/other_user}","gists_url":"https://api.github.com/users/roydahan/gists{/gist_id}","starred_url":"https://api.github.com/users/roydahan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roydahan/subscriptions","organizations_url":"https://api.github.com/users/roydahan/orgs","repos_url":"https://api.github.com/users/roydahan/repos","events_url":"https://api.github.com/users/roydahan/events{/privacy}","received_events_url":"https://api.github.com/users/roydahan/received_events","type":"User","site_admin":false},"body":"Same for the short one.","created_at":"2017-07-30T08:48:33Z","updated_at":"2017-07-30T08:48:33Z","html_url":"https://github.com/scylladb/scylla-cluster-tests/pull/333#discussion_r130236938","pull_request_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333","_links":{"self":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/comments/130236938"},"html":{"href":"https://github.com/scylladb/scylla-cluster-tests/pull/333#discussion_r130236938"},"pull_request":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333"}}},"pull_request":{"url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333","id":132893657,"html_url":"https://github.com/scylladb/scylla-cluster-tests/pull/333","diff_url":"https://github.com/scylladb/scylla-cluster-tests/pull/333.diff","patch_url":"https://github.com/scylladb/scylla-cluster-tests/pull/333.patch","issue_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/issues/333","number":333,"state":"open","locked":false,"title":"longevity: authenticator support","user":{"login":"amoskong","id":309708,"avatar_url":"https://avatars0.githubusercontent.com/u/309708?v=4","gravatar_id":"","url":"https://api.github.com/users/amoskong","html_url":"https://github.com/amoskong","followers_url":"https://api.github.com/users/amoskong/followers","following_url":"https://api.github.com/users/amoskong/following{/other_user}","gists_url":"https://api.github.com/users/amoskong/gists{/gist_id}","starred_url":"https://api.github.com/users/amoskong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amoskong/subscriptions","organizations_url":"https://api.github.com/users/amoskong/orgs","repos_url":"https://api.github.com/users/amoskong/repos","events_url":"https://api.github.com/users/amoskong/events{/privacy}","received_events_url":"https://api.github.com/users/amoskong/received_events","type":"User","site_admin":false},"body":"User and password will be passed through c-s cmdline, and authenticator can be configured from yaml config.","created_at":"2017-07-28T04:38:01Z","updated_at":"2017-07-30T08:48:33Z","merge_commit_sha":"2509f8af60f52ebd403ba68d3b8d8e1caaf04e22","assignees":[],"requested_reviewers":[{"login":"larisau","id":25477265,"avatar_url":"https://avatars3.githubusercontent.com/u/25477265?v=4","gravatar_id":"","url":"https://api.github.com/users/larisau","html_url":"https://github.com/larisau","followers_url":"https://api.github.com/users/larisau/followers","following_url":"https://api.github.com/users/larisau/following{/other_user}","gists_url":"https://api.github.com/users/larisau/gists{/gist_id}","starred_url":"https://api.github.com/users/larisau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larisau/subscriptions","organizations_url":"https://api.github.com/users/larisau/orgs","repos_url":"https://api.github.com/users/larisau/repos","events_url":"https://api.github.com/users/larisau/events{/privacy}","received_events_url":"https://api.github.com/users/larisau/received_events","type":"User","site_admin":false}],"commits_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333/commits","review_comments_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333/comments","review_comment_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/comments{/number}","comments_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/issues/333/comments","statuses_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/statuses/1e68163b2240ac7e84ecb64974f06347c288881f","head":{"label":"amoskong:auth","ref":"auth","sha":"1e68163b2240ac7e84ecb64974f06347c288881f","user":{"login":"amoskong","id":309708,"avatar_url":"https://avatars0.githubusercontent.com/u/309708?v=4","gravatar_id":"","url":"https://api.github.com/users/amoskong","html_url":"https://github.com/amoskong","followers_url":"https://api.github.com/users/amoskong/followers","following_url":"https://api.github.com/users/amoskong/following{/other_user}","gists_url":"https://api.github.com/users/amoskong/gists{/gist_id}","starred_url":"https://api.github.com/users/amoskong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amoskong/subscriptions","organizations_url":"https://api.github.com/users/amoskong/orgs","repos_url":"https://api.github.com/users/amoskong/repos","events_url":"https://api.github.com/users/amoskong/events{/privacy}","received_events_url":"https://api.github.com/users/amoskong/received_events","type":"User","site_admin":false},"repo":{"id":61584415,"name":"scylla-cluster-tests","full_name":"amoskong/scylla-cluster-tests","owner":{"login":"amoskong","id":309708,"avatar_url":"https://avatars0.githubusercontent.com/u/309708?v=4","gravatar_id":"","url":"https://api.github.com/users/amoskong","html_url":"https://github.com/amoskong","followers_url":"https://api.github.com/users/amoskong/followers","following_url":"https://api.github.com/users/amoskong/following{/other_user}","gists_url":"https://api.github.com/users/amoskong/gists{/gist_id}","starred_url":"https://api.github.com/users/amoskong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amoskong/subscriptions","organizations_url":"https://api.github.com/users/amoskong/orgs","repos_url":"https://api.github.com/users/amoskong/repos","events_url":"https://api.github.com/users/amoskong/events{/privacy}","received_events_url":"https://api.github.com/users/amoskong/received_events","type":"User","site_admin":false},"private":false,"html_url":"https://github.com/amoskong/scylla-cluster-tests","description":"Tests for Scylla Clusters","fork":true,"url":"https://api.github.com/repos/amoskong/scylla-cluster-tests","forks_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/forks","keys_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/keys{/key_id}","collaborators_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/teams","hooks_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/hooks","issue_events_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/issues/events{/number}","events_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/events","assignees_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/assignees{/user}","branches_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/branches{/branch}","tags_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/tags","blobs_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/git/refs{/sha}","trees_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/git/trees{/sha}","statuses_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/statuses/{sha}","languages_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/languages","stargazers_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/stargazers","contributors_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/contributors","subscribers_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/subscribers","subscription_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/subscription","commits_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/commits{/sha}","git_commits_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/git/commits{/sha}","comments_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/comments{/number}","issue_comment_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/issues/comments{/number}","contents_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/contents/{+path}","compare_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/compare/{base}...{head}","merges_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/merges","archive_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/downloads","issues_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/issues{/number}","pulls_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/pulls{/number}","milestones_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/milestones{/number}","notifications_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/labels{/name}","releases_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/releases{/id}","deployments_url":"https://api.github.com/repos/amoskong/scylla-cluster-tests/deployments","created_at":"2016-06-20T22:22:11Z","updated_at":"2016-06-20T22:22:12Z","pushed_at":"2017-07-28T04:35:12Z","git_url":"git://github.com/amoskong/scylla-cluster-tests.git","ssh_url":"git@github.com:amoskong/scylla-cluster-tests.git","clone_url":"https://github.com/amoskong/scylla-cluster-tests.git","svn_url":"https://github.com/amoskong/scylla-cluster-tests","homepage":"","size":25653,"stargazers_count":0,"watchers_count":0,"language":"Python","has_issues":false,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master"}},"base":{"label":"scylladb:master","ref":"master","sha":"697384bcbc8b5514b31c7c614835282fb4394a58","user":{"login":"scylladb","id":14364730,"avatar_url":"https://avatars2.githubusercontent.com/u/14364730?v=4","gravatar_id":"","url":"https://api.github.com/users/scylladb","html_url":"https://github.com/scylladb","followers_url":"https://api.github.com/users/scylladb/followers","following_url":"https://api.github.com/users/scylladb/following{/other_user}","gists_url":"https://api.github.com/users/scylladb/gists{/gist_id}","starred_url":"https://api.github.com/users/scylladb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scylladb/subscriptions","organizations_url":"https://api.github.com/users/scylladb/orgs","repos_url":"https://api.github.com/users/scylladb/repos","events_url":"https://api.github.com/users/scylladb/events{/privacy}","received_events_url":"https://api.github.com/users/scylladb/received_events","type":"Organization","site_admin":false},"repo":{"id":48770856,"name":"scylla-cluster-tests","full_name":"scylladb/scylla-cluster-tests","owner":{"login":"scylladb","id":14364730,"avatar_url":"https://avatars2.githubusercontent.com/u/14364730?v=4","gravatar_id":"","url":"https://api.github.com/users/scylladb","html_url":"https://github.com/scylladb","followers_url":"https://api.github.com/users/scylladb/followers","following_url":"https://api.github.com/users/scylladb/following{/other_user}","gists_url":"https://api.github.com/users/scylladb/gists{/gist_id}","starred_url":"https://api.github.com/users/scylladb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scylladb/subscriptions","organizations_url":"https://api.github.com/users/scylladb/orgs","repos_url":"https://api.github.com/users/scylladb/repos","events_url":"https://api.github.com/users/scylladb/events{/privacy}","received_events_url":"https://api.github.com/users/scylladb/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/scylladb/scylla-cluster-tests","description":"Tests for Scylla Clusters","fork":false,"url":"https://api.github.com/repos/scylladb/scylla-cluster-tests","forks_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/forks","keys_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/keys{/key_id}","collaborators_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/teams","hooks_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/hooks","issue_events_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/issues/events{/number}","events_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/events","assignees_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/assignees{/user}","branches_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/branches{/branch}","tags_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/tags","blobs_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/git/refs{/sha}","trees_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/git/trees{/sha}","statuses_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/statuses/{sha}","languages_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/languages","stargazers_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/stargazers","contributors_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/contributors","subscribers_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/subscribers","subscription_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/subscription","commits_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/commits{/sha}","git_commits_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/git/commits{/sha}","comments_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/comments{/number}","issue_comment_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/issues/comments{/number}","contents_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/contents/{+path}","compare_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/compare/{base}...{head}","merges_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/merges","archive_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/downloads","issues_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/issues{/number}","pulls_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls{/number}","milestones_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/milestones{/number}","notifications_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/labels{/name}","releases_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/releases{/id}","deployments_url":"https://api.github.com/repos/scylladb/scylla-cluster-tests/deployments","created_at":"2015-12-29T23:03:42Z","updated_at":"2017-07-20T02:45:37Z","pushed_at":"2017-07-28T04:38:01Z","git_url":"git://github.com/scylladb/scylla-cluster-tests.git","ssh_url":"git@github.com:scylladb/scylla-cluster-tests.git","clone_url":"https://github.com/scylladb/scylla-cluster-tests.git","svn_url":"https://github.com/scylladb/scylla-cluster-tests","homepage":"","size":2690,"stargazers_count":17,"watchers_count":17,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":10,"open_issues_count":19,"forks":10,"open_issues":19,"watchers":17,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333"},"html":{"href":"https://github.com/scylladb/scylla-cluster-tests/pull/333"},"issue":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/issues/333"},"comments":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/issues/333/comments"},"review_comments":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333/comments"},"review_comment":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/pulls/333/commits"},"statuses":{"href":"https://api.github.com/repos/scylladb/scylla-cluster-tests/statuses/1e68163b2240ac7e84ecb64974f06347c288881f"}}}},"public":true,"created_at":"2017-07-30T08:48:33Z","org":{"id":14364730,"login":"scylladb","gravatar_id":"","url":"https://api.github.com/orgs/scylladb","avatar_url":"https://avatars.githubusercontent.com/u/14364730?"},"channel":"github-events"}
 */